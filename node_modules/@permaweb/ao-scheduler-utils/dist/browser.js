function c(r){return r!=null&&typeof r=="object"&&r["@@functional/placeholder"]===!0}function p(r){return function t(e){return arguments.length===0||c(e)?t:r.apply(this,arguments)}}function u(r){return function t(e,o){switch(arguments.length){case 0:return t;case 1:return c(e)?t:p(function(n){return r(e,n)});default:return c(e)&&c(o)?t:c(e)?p(function(n){return r(n,o)}):c(o)?p(function(n){return r(e,n)}):r(e,o)}}}function b(r,t){switch(r){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,o){return t.apply(this,arguments)};case 3:return function(e,o,n){return t.apply(this,arguments)};case 4:return function(e,o,n,i){return t.apply(this,arguments)};case 5:return function(e,o,n,i,a){return t.apply(this,arguments)};case 6:return function(e,o,n,i,a,f){return t.apply(this,arguments)};case 7:return function(e,o,n,i,a,f,s){return t.apply(this,arguments)};case 8:return function(e,o,n,i,a,f,s,l){return t.apply(this,arguments)};case 9:return function(e,o,n,i,a,f,s,l,_){return t.apply(this,arguments)};case 10:return function(e,o,n,i,a,f,s,l,_,d){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function Y(r,t,e){return function(){for(var o=[],n=0,i=r,a=0,f=!1;a<t.length||n<arguments.length;){var s;a<t.length&&(!c(t[a])||n>=arguments.length)?s=t[a]:(s=arguments[n],n+=1),o[a]=s,c(s)?f=!0:i-=1,a+=1}return!f&&i<=0?e.apply(this,o):b(Math.max(0,i),Y(r,o,e))}}var we=u(function(t,e){return t===1?p(e):b(t,Y(t,[],e))}),K=we;function D(r){return function t(e,o,n){switch(arguments.length){case 0:return t;case 1:return c(e)?t:u(function(i,a){return r(e,i,a)});case 2:return c(e)&&c(o)?t:c(e)?u(function(i,a){return r(i,o,a)}):c(o)?u(function(i,a){return r(e,i,a)}):p(function(i){return r(e,o,i)});default:return c(e)&&c(o)&&c(n)?t:c(e)&&c(o)?u(function(i,a){return r(i,a,n)}):c(e)&&c(n)?u(function(i,a){return r(i,o,a)}):c(o)&&c(n)?u(function(i,a){return r(e,i,a)}):c(e)?p(function(i){return r(i,o,n)}):c(o)?p(function(i){return r(e,i,n)}):c(n)?p(function(i){return r(e,o,i)}):r(e,o,n)}}}var N=Array.isArray||function(t){return t!=null&&t.length>=0&&Object.prototype.toString.call(t)==="[object Array]"};function ht(r){return r!=null&&typeof r["@@transducer/step"]=="function"}function P(r,t,e){return function(){if(arguments.length===0)return e();var o=arguments[arguments.length-1];if(!N(o)){for(var n=0;n<r.length;){if(typeof o[r[n]]=="function")return o[r[n]].apply(o,Array.prototype.slice.call(arguments,0,-1));n+=1}if(ht(o)){var i=t.apply(null,Array.prototype.slice.call(arguments,0,-1));return i(o)}}return e.apply(this,arguments)}}function pt(r){return r&&r["@@transducer/reduced"]?r:{"@@transducer/value":r,"@@transducer/reduced":!0}}var F={init:function(){return this.xf["@@transducer/init"]()},result:function(r){return this.xf["@@transducer/result"](r)}};function Z(r){for(var t=[],e;!(e=r.next()).done;)t.push(e.value);return t}function Q(r,t,e){for(var o=0,n=e.length;o<n;){if(r(t,e[o]))return!0;o+=1}return!1}function dt(r){var t=String(r).match(/^function (\w*)/);return t==null?"":t[1]}function C(r,t){return Object.prototype.hasOwnProperty.call(t,r)}function Se(r,t){return r===t?r!==0||1/r===1/t:r!==r&&t!==t}var tt=typeof Object.is=="function"?Object.is:Se;var Dt=Object.prototype.toString,ve=function(){return Dt.call(arguments)==="[object Arguments]"?function(t){return Dt.call(t)==="[object Arguments]"}:function(t){return C("callee",t)}}(),Pt=ve;var Oe=!{toString:null}.propertyIsEnumerable("toString"),Nt=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Ut=function(){"use strict";return arguments.propertyIsEnumerable("length")}(),Ae=function(t,e){for(var o=0;o<t.length;){if(t[o]===e)return!0;o+=1}return!1},be=typeof Object.keys=="function"&&!Ut?p(function(t){return Object(t)!==t?[]:Object.keys(t)}):p(function(t){if(Object(t)!==t)return[];var e,o,n=[],i=Ut&&Pt(t);for(e in t)C(e,t)&&(!i||e!=="length")&&(n[n.length]=e);if(Oe)for(o=Nt.length-1;o>=0;)e=Nt[o],C(e,t)&&!Ae(n,e)&&(n[n.length]=e),o-=1;return n}),O=be;var Te=p(function(t){return t===null?"Null":t===void 0?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}),mt=Te;function Bt(r,t,e,o){var n=Z(r),i=Z(t);function a(f,s){return q(f,s,e.slice(),o.slice())}return!Q(function(f,s){return!Q(a,s,f)},i,n)}function q(r,t,e,o){if(tt(r,t))return!0;var n=mt(r);if(n!==mt(t))return!1;if(typeof r["fantasy-land/equals"]=="function"||typeof t["fantasy-land/equals"]=="function")return typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](t)&&typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](r);if(typeof r.equals=="function"||typeof t.equals=="function")return typeof r.equals=="function"&&r.equals(t)&&typeof t.equals=="function"&&t.equals(r);switch(n){case"Arguments":case"Array":case"Object":if(typeof r.constructor=="function"&&dt(r.constructor)==="Promise")return r===t;break;case"Boolean":case"Number":case"String":if(!(typeof r==typeof t&&tt(r.valueOf(),t.valueOf())))return!1;break;case"Date":if(!tt(r.valueOf(),t.valueOf()))return!1;break;case"Error":return r.name===t.name&&r.message===t.message;case"RegExp":if(!(r.source===t.source&&r.global===t.global&&r.ignoreCase===t.ignoreCase&&r.multiline===t.multiline&&r.sticky===t.sticky&&r.unicode===t.unicode))return!1;break}for(var i=e.length-1;i>=0;){if(e[i]===r)return o[i]===t;i-=1}switch(n){case"Map":return r.size!==t.size?!1:Bt(r.entries(),t.entries(),e.concat([r]),o.concat([t]));case"Set":return r.size!==t.size?!1:Bt(r.values(),t.values(),e.concat([r]),o.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var a=O(r);if(a.length!==O(t).length)return!1;var f=e.concat([r]),s=o.concat([t]);for(i=a.length-1;i>=0;){var l=a[i];if(!(C(l,t)&&q(t[l],r[l],f,s)))return!1;i-=1}return!0}var Ee=u(function(t,e){return q(t,e,[],[])}),et=Ee;function xt(r,t,e){var o,n;if(typeof r.indexOf=="function")switch(typeof t){case"number":if(t===0){for(o=1/t;e<r.length;){if(n=r[e],n===0&&1/n===o)return e;e+=1}return-1}else if(t!==t){for(;e<r.length;){if(n=r[e],typeof n=="number"&&n!==n)return e;e+=1}return-1}return r.indexOf(t,e);case"string":case"boolean":case"function":case"undefined":return r.indexOf(t,e);case"object":if(t===null)return r.indexOf(t,e)}for(;e<r.length;){if(et(r[e],t))return e;e+=1}return-1}function gt(r,t){return xt(t,r,0)>=0}function T(r,t){for(var e=0,o=t.length,n=Array(o);e<o;)n[e]=r(t[e]),e+=1;return n}function k(r){var t=r.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+t.replace(/"/g,'\\"')+'"'}var M=function(t){return(t<10?"0":"")+t},We=typeof Date.prototype.toISOString=="function"?function(t){return t.toISOString()}:function(t){return t.getUTCFullYear()+"-"+M(t.getUTCMonth()+1)+"-"+M(t.getUTCDate())+"T"+M(t.getUTCHours())+":"+M(t.getUTCMinutes())+":"+M(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},qt=We;function yt(r){return function(){return!r.apply(this,arguments)}}function G(r,t,e){for(var o=0,n=e.length;o<n;)t=r(t,e[o]),o+=1;return t}function _t(r,t){for(var e=0,o=t.length,n=[];e<o;)r(t[e])&&(n[n.length]=t[e]),e+=1;return n}function wt(r){return Object.prototype.toString.call(r)==="[object Object]"}var Fe=function(){function r(t,e){this.xf=e,this.f=t}return r.prototype["@@transducer/init"]=F.init,r.prototype["@@transducer/result"]=F.result,r.prototype["@@transducer/step"]=function(t,e){return this.f(e)?this.xf["@@transducer/step"](t,e):t},r}();function St(r){return function(t){return new Fe(r,t)}}var Ce=u(P(["fantasy-land/filter","filter"],St,function(r,t){return wt(t)?G(function(e,o){return r(t[o])&&(e[o]=t[o]),e},{},O(t)):_t(r,t)})),kt=Ce;var Ie=u(function(t,e){return kt(yt(t),e)}),Mt=Ie;function rt(r,t){var e=function(a){var f=t.concat([r]);return gt(a,f)?"<Circular>":rt(a,f)},o=function(i,a){return T(function(f){return k(f)+": "+e(i[f])},a.slice().sort())};switch(Object.prototype.toString.call(r)){case"[object Arguments]":return"(function() { return arguments; }("+T(e,r).join(", ")+"))";case"[object Array]":return"["+T(e,r).concat(o(r,Mt(function(i){return/^\d+$/.test(i)},O(r)))).join(", ")+"]";case"[object Boolean]":return typeof r=="object"?"new Boolean("+e(r.valueOf())+")":r.toString();case"[object Date]":return"new Date("+(isNaN(r.valueOf())?e(NaN):k(qt(r)))+")";case"[object Map]":return"new Map("+e(Array.from(r))+")";case"[object Null]":return"null";case"[object Number]":return typeof r=="object"?"new Number("+e(r.valueOf())+")":1/r===-1/0?"-0":r.toString(10);case"[object Set]":return"new Set("+e(Array.from(r).sort())+")";case"[object String]":return typeof r=="object"?"new String("+e(r.valueOf())+")":k(r);case"[object Undefined]":return"undefined";default:if(typeof r.toString=="function"){var n=r.toString();if(n!=="[object Object]")return n}return"{"+o(r,O(r)).join(", ")+"}"}}var je=p(function(t){return rt(t,[])}),vt=je;var Re=u(function(t,e){if(t===e)return e;function o(s,l){if(s>l!=l>s)return l>s?l:s}var n=o(t,e);if(n!==void 0)return n;var i=o(typeof t,typeof e);if(i!==void 0)return i===typeof t?t:e;var a=vt(t),f=o(a,vt(e));return f!==void 0&&f===a?t:e}),Gt=Re;var Le=function(){function r(t,e){this.xf=e,this.f=t}return r.prototype["@@transducer/init"]=F.init,r.prototype["@@transducer/result"]=F.result,r.prototype["@@transducer/step"]=function(t,e){return this.xf["@@transducer/step"](t,this.f(e))},r}(),ze=function(t){return function(e){return new Le(t,e)}},Ht=ze;var De=u(P(["fantasy-land/map","map"],Ht,function(t,e){switch(Object.prototype.toString.call(e)){case"[object Function]":return K(e.length,function(){return t.call(this,e.apply(this,arguments))});case"[object Object]":return G(function(o,n){return o[n]=t(e[n]),o},{},O(e));default:return T(t,e)}})),$t=De;var ot=Number.isInteger||function(t){return t<<0===t};function H(r){return Object.prototype.toString.call(r)==="[object String]"}var Pe=u(function(t,e){var o=t<0?e.length+t:t;return H(e)?e.charAt(o):e[o]}),nt=Pe;var Ne=u(function(t,e){if(e!=null)return ot(t)?nt(t,e):e[t]}),I=Ne;var Ue=u(function(t,e){return $t(I(t),e)}),Xt=Ue;var Be=p(function(t){return N(t)?!0:!t||typeof t!="object"||H(t)?!1:t.length===0?!0:t.length>0?t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1):!1}),Vt=Be;var Jt=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function Ot(r,t,e){return function(n,i,a){if(Vt(a))return r(n,i,a);if(a==null)return i;if(typeof a["fantasy-land/reduce"]=="function")return t(n,i,a,"fantasy-land/reduce");if(a[Jt]!=null)return e(n,i,a[Jt]());if(typeof a.next=="function")return e(n,i,a);if(typeof a.reduce=="function")return t(n,i,a,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function At(r,t,e){for(var o=0,n=e.length;o<n;){if(t=r["@@transducer/step"](t,e[o]),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}o+=1}return r["@@transducer/result"](t)}var qe=u(function(t,e){return b(t.length,function(){return t.apply(e,arguments)})}),Yt=qe;function ke(r,t,e){for(var o=e.next();!o.done;){if(t=r["@@transducer/step"](t,o.value),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}o=e.next()}return r["@@transducer/result"](t)}function Me(r,t,e,o){return r["@@transducer/result"](e[o](Yt(r["@@transducer/step"],r),t))}var Ge=Ot(At,Me,ke),Kt=Ge;var He=function(){function r(t){this.f=t}return r.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},r.prototype["@@transducer/result"]=function(t){return t},r.prototype["@@transducer/step"]=function(t,e){return this.f(t,e)},r}();function bt(r){return new He(r)}var $e=D(function(r,t,e){return Kt(typeof r=="function"?bt(r):r,t,e)}),it=$e;function Tt(r,t){return function(){return t.call(this,r.apply(this,arguments))}}function $(r,t){return function(){var e=arguments.length;if(e===0)return t();var o=arguments[e-1];return N(o)||typeof o[r]!="function"?t.apply(this,arguments):o[r].apply(o,Array.prototype.slice.call(arguments,0,e-1))}}var Xe=D($("slice",function(t,e,o){return Array.prototype.slice.call(o,t,e)})),Zt=Xe;var Ve=p($("tail",Zt(1,1/0))),Qt=Ve;function X(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return b(arguments[0].length,it(Tt,arguments[0],Qt(arguments)))}var Je=u(function(t,e){return K(it(Gt,0,Xt("length",e)),function(){var o=arguments,n=this;return t.apply(n,T(function(i){return i.apply(n,o)},e))})}),te=Je;var Ye=u(function(t,e){return e==null||e!==e?t:e}),V=Ye;var Ke=function(){function r(t,e){this.xf=e,this.f=t,this.found=!1}return r.prototype["@@transducer/init"]=F.init,r.prototype["@@transducer/result"]=function(t){return this.found||(t=this.xf["@@transducer/step"](t,void 0)),this.xf["@@transducer/result"](t)},r.prototype["@@transducer/step"]=function(t,e){return this.f(e)&&(this.found=!0,t=pt(this.xf["@@transducer/step"](t,e))),t},r}();function Et(r){return function(t){return new Ke(r,t)}}var Ze=u(P(["find"],Et,function(t,e){for(var o=0,n=e.length;o<n;){if(t(e[o]))return e[o];o+=1}})),Wt=Ze;var Qe=p(function(t){return te(function(){return Array.prototype.slice.call(arguments,0)},t)}),Ft=Qe;var tr=u(function(t,e){return t.map(function(o){for(var n=e,i=0,a;i<o.length;){if(n==null)return;a=o[i],n=ot(a)?nt(a,n):n[a],i+=1}return n})}),ee=tr;var er=u(function(t,e){return ee([t],e)[0]}),at=er;var rr=D(function(t,e,o){return et(t,I(e,o))}),Ct=rr;var E=class r extends Error{static name="InvalidSchedulerLocation";constructor(...t){super(...t),this.name=r.name}},st=class r extends Error{static name="SchedulerTagNotFound";constructor(...t){super(...t),this.name=r.name}},ft=class r extends Error{static name="TransactionNotFound";constructor(...t){super(...t),this.name=r.name}};var or="Url",nr="Time-To-Live",ir="Scheduler",It=r=>X(V([]),Wt(Ct(r,"name")),V({}),I("value")),re=r=>X(t=>{if(!t)throw new ft(r);return t},I("tags"),V([]));function oe({fetch:r,GATEWAY_URL:t}){return async({query:e,variables:o})=>r(`${t}/graphql`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,variables:o})}).then(n=>n.json())}function ne({fetch:r,GATEWAY_URL:t}){let e=oe({fetch:r,GATEWAY_URL:t}),o=ut({fetch:r,GATEWAY_URL:t}),n=`
    query GetTransactions ($transactionIds: [ID!]!) {
      transactions(ids: $transactionIds) {
        edges {
          node {
            tags {
              name
              value
            }
          }
        }
      }
    }
  `;return async i=>e({query:n,variables:{transactionIds:[i]}}).then(at(["data","transactions","edges","0","node"])).then(re(`Process ${i} was not found on gateway ${t}`)).then(It(ir)).then(a=>{if(!a)throw new st('No "Scheduler" tag found on process');return o(a)})}function ut({fetch:r,GATEWAY_URL:t}){let e=oe({fetch:r,GATEWAY_URL:t}),o=`
    query GetSchedulerLocation ($owner: String!) {
      transactions (
        owners: [$owner]
        tags: [
          { name: "Data-Protocol", values: ["ao"] },
          { name: "Type", values: ["Scheduler-Location"] }
        ]
        # Only need the most recent Scheduler-Location
        sort: HEIGHT_DESC
        first: 1
      ) {
        edges {
          node {
            tags {
              name
              value
            }
          }
        }
      }
    }
  `;return async n=>e({query:o,variables:{owner:n}}).then(at(["data","transactions","edges","0","node"])).then(re(`Could not find 'Scheduler-Location' owner by wallet ${n}`)).then(Ft([It(or),It(nr)])).then(([i,a])=>{if(!i)throw new E('No "Url" tag found on Scheduler-Location');if(!a)throw new E('No "Time-To-Live" tag found on Scheduler-Location');return{url:i,ttl:a,owner:n}})}var U=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ae=new Set,jt=typeof process=="object"&&process?process:{},se=(r,t,e,o)=>{typeof jt.emitWarning=="function"?jt.emitWarning(r,t,e,o):console.error(`[${e}] ${t}: ${r}`)},lt=globalThis.AbortController,ie=globalThis.AbortSignal;if(typeof lt>"u"){ie=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(o,n){this._onabort.push(n)}},lt=class{constructor(){t()}signal=new ie;abort(o){if(!this.signal.aborted){this.signal.reason=o,this.signal.aborted=!0;for(let n of this.signal._onabort)n(o);this.signal.onabort?.(o)}}};let r=jt.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{r&&(r=!1,se("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}var sr=r=>!ae.has(r),ki=Symbol("type"),j=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),fe=r=>j(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?B:null:null,B=class extends Array{constructor(t){super(t),this.fill(0)}},Rt=class r{heap;length;static#f=!1;static create(t){let e=fe(t);if(!e)return[];r.#f=!0;let o=new r(t,e);return r.#f=!1,o}constructor(t,e){if(!r.#f)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},ct=class r{#f;#c;#m;#x;#F;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#g;#o;#r;#t;#u;#h;#s;#i;#y;#a;#_;#w;#p;#S;#b;#l;static unsafeExposeInternals(t){return{starts:t.#w,ttls:t.#p,sizes:t.#_,keyMap:t.#o,keyList:t.#r,valList:t.#t,next:t.#u,prev:t.#h,get head(){return t.#s},get tail(){return t.#i},free:t.#y,isBackgroundFetch:e=>t.#e(e),backgroundFetch:(e,o,n,i)=>t.#j(e,o,n,i),moveToTail:e=>t.#W(e),indexes:e=>t.#v(e),rindexes:e=>t.#O(e),isStale:e=>t.#d(e)}}get max(){return this.#f}get maxSize(){return this.#c}get calculatedSize(){return this.#g}get size(){return this.#n}get fetchMethod(){return this.#F}get dispose(){return this.#m}get disposeAfter(){return this.#x}constructor(t){let{max:e=0,ttl:o,ttlResolution:n=1,ttlAutopurge:i,updateAgeOnGet:a,updateAgeOnHas:f,allowStale:s,dispose:l,disposeAfter:_,noDisposeOnSet:d,noUpdateTTL:x,maxSize:m=0,maxEntrySize:L=0,sizeCalculation:g,fetchMethod:S,noDeleteOnFetchRejection:h,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:A,allowStaleOnFetchAbort:y,ignoreFetchAbort:v}=t;if(e!==0&&!j(e))throw new TypeError("max option must be a nonnegative integer");let z=e?fe(e):Array;if(!z)throw new Error("invalid max value: "+e);if(this.#f=e,this.#c=m,this.maxEntrySize=L||this.#c,this.sizeCalculation=g,this.sizeCalculation){if(!this.#c&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(S!==void 0&&typeof S!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#F=S,this.#b=!!S,this.#o=new Map,this.#r=new Array(e).fill(void 0),this.#t=new Array(e).fill(void 0),this.#u=new z(e),this.#h=new z(e),this.#s=0,this.#i=0,this.#y=Rt.create(e),this.#n=0,this.#g=0,typeof l=="function"&&(this.#m=l),typeof _=="function"?(this.#x=_,this.#a=[]):(this.#x=void 0,this.#a=void 0),this.#S=!!this.#m,this.#l=!!this.#x,this.noDisposeOnSet=!!d,this.noUpdateTTL=!!x,this.noDeleteOnFetchRejection=!!h,this.allowStaleOnFetchRejection=!!A,this.allowStaleOnFetchAbort=!!y,this.ignoreFetchAbort=!!v,this.maxEntrySize!==0){if(this.#c!==0&&!j(this.#c))throw new TypeError("maxSize must be a positive integer if specified");if(!j(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#N()}if(this.allowStale=!!s,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!f,this.ttlResolution=j(n)||n===0?n:1,this.ttlAutopurge=!!i,this.ttl=o||0,this.ttl){if(!j(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#R()}if(this.#f===0&&this.ttl===0&&this.#c===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#f&&!this.#c){let W="LRU_CACHE_UNBOUNDED";sr(W)&&(ae.add(W),se("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",W,r))}}getRemainingTTL(t){return this.#o.has(t)?1/0:0}#R(){let t=new B(this.#f),e=new B(this.#f);this.#p=t,this.#w=e,this.#L=(i,a,f=U.now())=>{if(e[i]=a!==0?f:0,t[i]=a,a!==0&&this.ttlAutopurge){let s=setTimeout(()=>{this.#d(i)&&this.delete(this.#r[i])},a+1);s.unref&&s.unref()}},this.#T=i=>{e[i]=t[i]!==0?U.now():0},this.#A=(i,a)=>{if(t[a]){let f=t[a],s=e[a];if(!f||!s)return;i.ttl=f,i.start=s,i.now=o||n();let l=i.now-s;i.remainingTTL=f-l}};let o=0,n=()=>{let i=U.now();if(this.ttlResolution>0){o=i;let a=setTimeout(()=>o=0,this.ttlResolution);a.unref&&a.unref()}return i};this.getRemainingTTL=i=>{let a=this.#o.get(i);if(a===void 0)return 0;let f=t[a],s=e[a];if(!f||!s)return 1/0;let l=(o||n())-s;return f-l},this.#d=i=>{let a=e[i],f=t[i];return!!f&&!!a&&(o||n())-a>f}}#T=()=>{};#A=()=>{};#L=()=>{};#d=()=>!1;#N(){let t=new B(this.#f);this.#g=0,this.#_=t,this.#E=e=>{this.#g-=t[e],t[e]=0},this.#z=(e,o,n,i)=>{if(this.#e(o))return 0;if(!j(n))if(i){if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(n=i(o,e),!j(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#C=(e,o,n)=>{if(t[e]=o,this.#c){let i=this.#c-t[e];for(;this.#g>i;)this.#I(!0)}this.#g+=t[e],n&&(n.entrySize=o,n.totalCalculatedSize=this.#g)}}#E=t=>{};#C=(t,e,o)=>{};#z=(t,e,o,n)=>{if(o||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#v({allowStale:t=this.allowStale}={}){if(this.#n)for(let e=this.#i;!(!this.#D(e)||((t||!this.#d(e))&&(yield e),e===this.#s));)e=this.#h[e]}*#O({allowStale:t=this.allowStale}={}){if(this.#n)for(let e=this.#s;!(!this.#D(e)||((t||!this.#d(e))&&(yield e),e===this.#i));)e=this.#u[e]}#D(t){return t!==void 0&&this.#o.get(this.#r[t])===t}*entries(){for(let t of this.#v())this.#t[t]!==void 0&&this.#r[t]!==void 0&&!this.#e(this.#t[t])&&(yield[this.#r[t],this.#t[t]])}*rentries(){for(let t of this.#O())this.#t[t]!==void 0&&this.#r[t]!==void 0&&!this.#e(this.#t[t])&&(yield[this.#r[t],this.#t[t]])}*keys(){for(let t of this.#v()){let e=this.#r[t];e!==void 0&&!this.#e(this.#t[t])&&(yield e)}}*rkeys(){for(let t of this.#O()){let e=this.#r[t];e!==void 0&&!this.#e(this.#t[t])&&(yield e)}}*values(){for(let t of this.#v())this.#t[t]!==void 0&&!this.#e(this.#t[t])&&(yield this.#t[t])}*rvalues(){for(let t of this.#O())this.#t[t]!==void 0&&!this.#e(this.#t[t])&&(yield this.#t[t])}[Symbol.iterator](){return this.entries()}find(t,e={}){for(let o of this.#v()){let n=this.#t[o],i=this.#e(n)?n.__staleWhileFetching:n;if(i!==void 0&&t(i,this.#r[o],this))return this.get(this.#r[o],e)}}forEach(t,e=this){for(let o of this.#v()){let n=this.#t[o],i=this.#e(n)?n.__staleWhileFetching:n;i!==void 0&&t.call(e,i,this.#r[o],this)}}rforEach(t,e=this){for(let o of this.#O()){let n=this.#t[o],i=this.#e(n)?n.__staleWhileFetching:n;i!==void 0&&t.call(e,i,this.#r[o],this)}}purgeStale(){let t=!1;for(let e of this.#O({allowStale:!0}))this.#d(e)&&(this.delete(this.#r[e]),t=!0);return t}info(t){let e=this.#o.get(t);if(e===void 0)return;let o=this.#t[e],n=this.#e(o)?o.__staleWhileFetching:o;if(n===void 0)return;let i={value:n};if(this.#p&&this.#w){let a=this.#p[e],f=this.#w[e];if(a&&f){let s=a-(U.now()-f);i.ttl=s,i.start=Date.now()}}return this.#_&&(i.size=this.#_[e]),i}dump(){let t=[];for(let e of this.#v({allowStale:!0})){let o=this.#r[e],n=this.#t[e],i=this.#e(n)?n.__staleWhileFetching:n;if(i===void 0||o===void 0)continue;let a={value:i};if(this.#p&&this.#w){a.ttl=this.#p[e];let f=U.now()-this.#w[e];a.start=Math.floor(Date.now()-f)}this.#_&&(a.size=this.#_[e]),t.unshift([o,a])}return t}load(t){this.clear();for(let[e,o]of t){if(o.start){let n=Date.now()-o.start;o.start=U.now()-n}this.set(e,o.value,o)}}set(t,e,o={}){if(e===void 0)return this.delete(t),this;let{ttl:n=this.ttl,start:i,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:f=this.sizeCalculation,status:s}=o,{noUpdateTTL:l=this.noUpdateTTL}=o,_=this.#z(t,e,o.size||0,f);if(this.maxEntrySize&&_>this.maxEntrySize)return s&&(s.set="miss",s.maxEntrySizeExceeded=!0),this.delete(t),this;let d=this.#n===0?void 0:this.#o.get(t);if(d===void 0)d=this.#n===0?this.#i:this.#y.length!==0?this.#y.pop():this.#n===this.#f?this.#I(!1):this.#n,this.#r[d]=t,this.#t[d]=e,this.#o.set(t,d),this.#u[this.#i]=d,this.#h[d]=this.#i,this.#i=d,this.#n++,this.#C(d,_,s),s&&(s.set="add"),l=!1;else{this.#W(d);let x=this.#t[d];if(e!==x){if(this.#b&&this.#e(x)){x.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:m}=x;m!==void 0&&!a&&(this.#S&&this.#m?.(m,t,"set"),this.#l&&this.#a?.push([m,t,"set"]))}else a||(this.#S&&this.#m?.(x,t,"set"),this.#l&&this.#a?.push([x,t,"set"]));if(this.#E(d),this.#C(d,_,s),this.#t[d]=e,s){s.set="replace";let m=x&&this.#e(x)?x.__staleWhileFetching:x;m!==void 0&&(s.oldValue=m)}}else s&&(s.set="update")}if(n!==0&&!this.#p&&this.#R(),this.#p&&(l||this.#L(d,n,i),s&&this.#A(s,d)),!a&&this.#l&&this.#a){let x=this.#a,m;for(;m=x?.shift();)this.#x?.(...m)}return this}pop(){try{for(;this.#n;){let t=this.#t[this.#s];if(this.#I(!0),this.#e(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#l&&this.#a){let t=this.#a,e;for(;e=t?.shift();)this.#x?.(...e)}}}#I(t){let e=this.#s,o=this.#r[e],n=this.#t[e];return this.#b&&this.#e(n)?n.__abortController.abort(new Error("evicted")):(this.#S||this.#l)&&(this.#S&&this.#m?.(n,o,"evict"),this.#l&&this.#a?.push([n,o,"evict"])),this.#E(e),t&&(this.#r[e]=void 0,this.#t[e]=void 0,this.#y.push(e)),this.#n===1?(this.#s=this.#i=0,this.#y.length=0):this.#s=this.#u[e],this.#o.delete(o),this.#n--,e}has(t,e={}){let{updateAgeOnHas:o=this.updateAgeOnHas,status:n}=e,i=this.#o.get(t);if(i!==void 0){let a=this.#t[i];if(this.#e(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#d(i))n&&(n.has="stale",this.#A(n,i));else return o&&this.#T(i),n&&(n.has="hit",this.#A(n,i)),!0}else n&&(n.has="miss");return!1}peek(t,e={}){let{allowStale:o=this.allowStale}=e,n=this.#o.get(t);if(n===void 0||!o&&this.#d(n))return;let i=this.#t[n];return this.#e(i)?i.__staleWhileFetching:i}#j(t,e,o,n){let i=e===void 0?void 0:this.#t[e];if(this.#e(i))return i;let a=new lt,{signal:f}=o;f?.addEventListener("abort",()=>a.abort(f.reason),{signal:a.signal});let s={signal:a.signal,options:o,context:n},l=(g,S=!1)=>{let{aborted:h}=a.signal,w=o.ignoreFetchAbort&&g!==void 0;if(o.status&&(h&&!S?(o.status.fetchAborted=!0,o.status.fetchError=a.signal.reason,w&&(o.status.fetchAbortIgnored=!0)):o.status.fetchResolved=!0),h&&!w&&!S)return d(a.signal.reason);let A=m;return this.#t[e]===m&&(g===void 0?A.__staleWhileFetching?this.#t[e]=A.__staleWhileFetching:this.delete(t):(o.status&&(o.status.fetchUpdated=!0),this.set(t,g,s.options))),g},_=g=>(o.status&&(o.status.fetchRejected=!0,o.status.fetchError=g),d(g)),d=g=>{let{aborted:S}=a.signal,h=S&&o.allowStaleOnFetchAbort,w=h||o.allowStaleOnFetchRejection,A=w||o.noDeleteOnFetchRejection,y=m;if(this.#t[e]===m&&(!A||y.__staleWhileFetching===void 0?this.delete(t):h||(this.#t[e]=y.__staleWhileFetching)),w)return o.status&&y.__staleWhileFetching!==void 0&&(o.status.returnedStale=!0),y.__staleWhileFetching;if(y.__returned===y)throw g},x=(g,S)=>{let h=this.#F?.(t,i,s);h&&h instanceof Promise&&h.then(w=>g(w===void 0?void 0:w),S),a.signal.addEventListener("abort",()=>{(!o.ignoreFetchAbort||o.allowStaleOnFetchAbort)&&(g(void 0),o.allowStaleOnFetchAbort&&(g=w=>l(w,!0)))})};o.status&&(o.status.fetchDispatched=!0);let m=new Promise(x).then(l,_),L=Object.assign(m,{__abortController:a,__staleWhileFetching:i,__returned:void 0});return e===void 0?(this.set(t,L,{...s.options,status:void 0}),e=this.#o.get(t)):this.#t[e]=L,L}#e(t){if(!this.#b)return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof lt}async fetch(t,e={}){let{allowStale:o=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:f=this.noDisposeOnSet,size:s=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:_=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:x=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:L=this.allowStaleOnFetchAbort,context:g,forceRefresh:S=!1,status:h,signal:w}=e;if(!this.#b)return h&&(h.fetch="get"),this.get(t,{allowStale:o,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:h});let A={allowStale:o,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:a,noDisposeOnSet:f,size:s,sizeCalculation:l,noUpdateTTL:_,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:x,allowStaleOnFetchAbort:L,ignoreFetchAbort:m,status:h,signal:w},y=this.#o.get(t);if(y===void 0){h&&(h.fetch="miss");let v=this.#j(t,y,A,g);return v.__returned=v}else{let v=this.#t[y];if(this.#e(v)){let zt=o&&v.__staleWhileFetching!==void 0;return h&&(h.fetch="inflight",zt&&(h.returnedStale=!0)),zt?v.__staleWhileFetching:v.__returned=v}let z=this.#d(y);if(!S&&!z)return h&&(h.fetch="hit"),this.#W(y),n&&this.#T(y),h&&this.#A(h,y),v;let W=this.#j(t,y,A,g),Lt=W.__staleWhileFetching!==void 0&&o;return h&&(h.fetch=z?"stale":"refresh",Lt&&z&&(h.returnedStale=!0)),Lt?W.__staleWhileFetching:W.__returned=W}}get(t,e={}){let{allowStale:o=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:a}=e,f=this.#o.get(t);if(f!==void 0){let s=this.#t[f],l=this.#e(s);return a&&this.#A(a,f),this.#d(f)?(a&&(a.get="stale"),l?(a&&o&&s.__staleWhileFetching!==void 0&&(a.returnedStale=!0),o?s.__staleWhileFetching:void 0):(i||this.delete(t),a&&o&&(a.returnedStale=!0),o?s:void 0)):(a&&(a.get="hit"),l?s.__staleWhileFetching:(this.#W(f),n&&this.#T(f),s))}else a&&(a.get="miss")}#P(t,e){this.#h[e]=t,this.#u[t]=e}#W(t){t!==this.#i&&(t===this.#s?this.#s=this.#u[t]:this.#P(this.#h[t],this.#u[t]),this.#P(this.#i,t),this.#i=t)}delete(t){let e=!1;if(this.#n!==0){let o=this.#o.get(t);if(o!==void 0)if(e=!0,this.#n===1)this.clear();else{this.#E(o);let n=this.#t[o];if(this.#e(n)?n.__abortController.abort(new Error("deleted")):(this.#S||this.#l)&&(this.#S&&this.#m?.(n,t,"delete"),this.#l&&this.#a?.push([n,t,"delete"])),this.#o.delete(t),this.#r[o]=void 0,this.#t[o]=void 0,o===this.#i)this.#i=this.#h[o];else if(o===this.#s)this.#s=this.#u[o];else{let i=this.#h[o];this.#u[i]=this.#u[o];let a=this.#u[o];this.#h[a]=this.#h[o]}this.#n--,this.#y.push(o)}}if(this.#l&&this.#a?.length){let o=this.#a,n;for(;n=o?.shift();)this.#x?.(...n)}return e}clear(){for(let t of this.#O({allowStale:!0})){let e=this.#t[t];if(this.#e(e))e.__abortController.abort(new Error("deleted"));else{let o=this.#r[t];this.#S&&this.#m?.(e,o,"delete"),this.#l&&this.#a?.push([e,o,"delete"])}}if(this.#o.clear(),this.#t.fill(void 0),this.#r.fill(void 0),this.#p&&this.#w&&(this.#p.fill(0),this.#w.fill(0)),this.#_&&this.#_.fill(0),this.#s=0,this.#i=0,this.#y.length=0,this.#g=0,this.#n=0,this.#l&&this.#a){let t=this.#a,e;for(;e=t?.shift();)this.#x?.(...e)}}};var R,J;function ue({size:r}){return R||(J=r,R=new ct({max:r,maxSize:1e6*5,sizeCalculation:t=>JSON.stringify(t).length,allowStale:!0}),R)}function le({cache:r=R}){return async t=>{if(J)return r.get(t)}}function ce({cache:r=R}){return async(t,{url:e,address:o},n)=>{if(J)return r.set(t,{url:e,address:o},{ttl:n})}}function he({cache:r=R}){return async t=>{if(J)return r.get(t)}}function pe({cache:r=R}){return async(t,e,o)=>{if(J)return r.set(t,{url:e,address:t},{ttl:o})}}function de({fetch:r}){return async(t,e)=>{let o=await r(`${t}?process-id=${e}`,{method:"GET",redirect:"manual"});return[301,302,307,308].includes(o.status)?new URL(o.headers.get("Location")).origin:t}}function me({loadProcessScheduler:r,cache:t,followRedirects:e,checkForRedirect:o}){let n=async(i,a,f)=>{let s={url:f,address:a.owner};return await Promise.all([t.setByProcess(i,s,a.ttl),t.setByOwner(a.owner,f,a.ttl)]),s};return i=>t.getByProcess(i).then(a=>a||r(i).then(async f=>{let s=f.url;return e&&(s=await o(f.url,i)),n(i,f,s)}))}function xe({loadScheduler:r,cache:t}){return e=>t.getByOwner(e).then(o=>o?{url:o.url}:r(e).then(n=>t.setByOwner(e,n.url,n.ttl).then(()=>({url:n.url}))).catch(n=>{if(!(n instanceof E))throw n}))}function ge({loadScheduler:r,cache:t}){return e=>t.getByOwner(e).then(o=>o?!0:r(e).then(n=>t.setByOwner(e,n.url,n.ttl)).then(()=>!0).catch(n=>{if(n instanceof E)return!1;throw n}))}var lr="https://arweave.net";function ye({cacheSize:r=100,GATEWAY_URL:t=lr,followRedirects:e=!1}={}){let o=ue({size:r}),n=he({cache:o}),i=le({cache:o}),a=pe({cache:o}),f=ce({cache:o}),s=me({loadProcessScheduler:ne({fetch,GATEWAY_URL:t}),cache:{getByProcess:i,getByOwner:n,setByProcess:f,setByOwner:a},followRedirects:e,checkForRedirect:de({fetch})}),l=ge({loadScheduler:ut({fetch,GATEWAY_URL:t}),cache:{getByProcess:i,getByOwner:n,setByProcess:f,setByOwner:a}}),_=xe({loadScheduler:ut({fetch,GATEWAY_URL:t}),cache:{getByProcess:i,getByOwner:n,setByProcess:f,setByOwner:a}});return{locate:s,validate:l,raw:_}}var cr=globalThis.GATEWAY_URL||void 0,hr=globalThis.SCHEDULER_UTILS_CACHE_SIZE||void 0,pr=globalThis.SCHEDULER_UTILS_FOLLOW_REDIRECTS==="true"||void 0,{locate:ra,validate:oa,raw:na}=ye({GATEWAY_URL:cr,cacheSize:hr,followRedirects:pr});export{E as InvalidSchedulerLocationError,st as SchedulerTagNotFoundError,ft as TransactionNotFoundError,ye as connect,ra as locate,na as raw,oa as validate};
